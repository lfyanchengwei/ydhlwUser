import{r as t,C as e,b as a,c as s,w as l,i as o,o as n,d as i,e as d,t as c,q as r,u,v as m,F as f,f as h,A as g,g as v,G as _}from"./index-Cr98tpWe.js";import{_ as p}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=p({data:()=>({event:{},comments:[],registrationStatus:"",registrationButtonText:"",showRegistrationModal:!1,registrationText:"",newCommentText:""}),methods:{fetchEventDetails(){const e=this.$route.query.eventId;t({url:`http://154.8.140.108:8883/api/events/get?eventId=${e}`,method:"GET",success:t=>{1===t.data.code&&(this.event=t.data.data)}})},fetchEventComments(){const e=this.$route.query.eventId;t({url:`http://154.8.140.108:8883/api/comments/getEventComments?eventId=${e}`,method:"GET",success:t=>{1===t.data.code&&(this.comments=t.data.data)}})},fetchRegistrationStatus(){const a=this.$route.query.eventId,s=e("userId");t({url:`http://154.8.140.108:8883/api/registration/getUserRegistrationStatus?eventId=${a}&userId=${s}`,method:"GET",success:t=>{1===t.data.code&&(console.log(t.data.data),this.registrationStatus=t.data.data,this.updateRegistrationButtonText())}})},updateRegistrationButtonText(){this.registrationButtonText={notReg:"报名参加",pending:"等待审核",approved:"审核已通过",rejected:"审核未通过",participated:"已成功参加"}[this.registrationStatus]||"状态未知"},handleRegister(){"notReg"===this.registrationStatus&&(this.showRegistrationModal=!0,console.log(this.showRegistrationModal))},closeModal(){this.showRegistrationModal=!1},formatDate:t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),registerForEvent(){const s=this.$route.query.eventId,l=e("userId"),o=this.registrationText;t({url:"http://154.8.140.108:8883/api/registration/registerEvent",method:"POST",data:{eventId:s,userId:l,registrationText:o},success:t=>{1===t.data.code?(this.showRegistrationModal=!1,this.fetchRegistrationStatus(),a({title:t.data.data,icon:"success"})):a({title:"报名失败",icon:"none"})},fail:()=>{a({title:"网络错误",icon:"none"})}})},addComment(s){const l=this.$route.query.eventId,o=e("userId");s.trim()?t({url:"http://154.8.140.108:8883/api/comments/addComment",method:"POST",data:{eventId:l,userId:o,commentText:s},success:t=>{1===t.data.code?(a({title:t.data.data,icon:"success"}),this.newCommentText="",this.fetchEventComments()):a({title:"评论失败",icon:"none"})},fail:()=>{a({title:"网络错误",icon:"none"})}}):a({title:"评论内容不能为空",icon:"none"})}},mounted(){this.fetchEventDetails(),this.fetchEventComments(),this.fetchRegistrationStatus()}},[["render",function(t,e,a,p,C,T){const x=h,I=g,R=o,b=v,w=_;return n(),s(R,{class:"event-details"},{default:l((()=>[i(R,{class:"header"},{default:l((()=>[i(x,{class:"title"},{default:l((()=>[d(c(C.event.title),1)])),_:1}),i(I,{class:"event-image",src:C.event.picUrl,mode:"aspectFill"},null,8,["src"])])),_:1}),i(R,{class:"details"},{default:l((()=>[i(x,{class:"description"},{default:l((()=>[d(c(C.event.description),1)])),_:1}),i(R,{class:"info"},{default:l((()=>[i(R,{class:"info-item"},{default:l((()=>[i(x,{class:"label"},{default:l((()=>[d("活动时间：")])),_:1}),i(x,{class:"value"},{default:l((()=>[d(c(T.formatDate(C.event.eventDate)),1)])),_:1})])),_:1}),i(R,{class:"info-item"},{default:l((()=>[i(x,{class:"label"},{default:l((()=>[d("活动地点：")])),_:1}),i(x,{class:"value"},{default:l((()=>[d(c(C.event.location),1)])),_:1})])),_:1}),i(R,{class:"info-item"},{default:l((()=>[i(x,{class:"label"},{default:l((()=>[d("活动容量：")])),_:1}),i(x,{class:"value"},{default:l((()=>[d(c(C.event.capacity)+"人",1)])),_:1})])),_:1}),i(R,{class:"info-item"},{default:l((()=>[i(x,{class:"label"},{default:l((()=>[d("报名截止：")])),_:1}),i(x,{class:"value"},{default:l((()=>[d(c(T.formatDate(C.event.registrationDeadline)),1)])),_:1})])),_:1})])),_:1})])),_:1}),i(R,{class:"interactive"},{default:l((()=>[i(b,{class:"register-button",disabled:"notReg"!==C.registrationStatus,onClick:T.handleRegister},{default:l((()=>[d(c(C.registrationButtonText),1)])),_:1},8,["disabled","onClick"]),C.showRegistrationModal?(n(),s(R,{key:0,class:"modal-wrapper"},{default:l((()=>[i(R,{class:"modal-overlay",onClick:T.closeModal},null,8,["onClick"]),i(R,{class:"modal-container"},{default:l((()=>[i(R,{class:"modal-header"},{default:l((()=>[i(x,{class:"modal-title"},{default:l((()=>[d("报名参加活动")])),_:1}),i(b,{class:"modal-close",onClick:T.closeModal},{default:l((()=>[d("×")])),_:1},8,["onClick"])])),_:1}),i(R,{class:"modal-body"},{default:l((()=>[i(R,{class:"modal-image"},{default:l((()=>[i(I,{src:C.event.picUrl,mode:"aspectFill"},null,8,["src"])])),_:1}),i(R,{class:"modal-info"},{default:l((()=>[i(x,{class:"modal-event-title"},{default:l((()=>[d(c(C.event.title),1)])),_:1}),i(x,{class:"modal-event-date"},{default:l((()=>[d(c(T.formatDate(C.event.eventDate)),1)])),_:1}),i(x,{class:"modal-event-location"},{default:l((()=>[d("📍 "+c(C.event.location),1)])),_:1})])),_:1}),i(w,{modelValue:C.registrationText,"onUpdate:modelValue":e[0]||(e[0]=t=>C.registrationText=t),class:"modal-textarea",placeholder:"请填写您的报名理由..."},{default:l((()=>[d("\r\n\t        ")])),_:1},8,["modelValue"])])),_:1}),i(R,{class:"modal-footer"},{default:l((()=>[i(b,{class:"submit-button",disabled:!C.registrationText.trim(),onClick:T.registerForEvent},{default:l((()=>[d(" 提交报名 ")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})])),_:1})):r("",!0),i(R,{class:"comments"},{default:l((()=>[i(R,{class:"add-comment"},{default:l((()=>[i(w,{class:"comment-input",modelValue:C.newCommentText,"onUpdate:modelValue":e[1]||(e[1]=t=>C.newCommentText=t),placeholder:"输入您的评论..."},null,8,["modelValue"]),i(b,{class:"submit-comment",onClick:e[2]||(e[2]=t=>T.addComment(C.newCommentText))},{default:l((()=>[d("提交评论")])),_:1})])),_:1}),i(R,{class:"comment-list"},{default:l((()=>[(n(!0),u(f,null,m(C.comments,(t=>(n(),s(R,{class:"comment-item",key:t.commentId},{default:l((()=>[i(x,{class:"comment-user"},{default:l((()=>[d(c(t.username),1)])),_:2},1024),i(x,{class:"comment-time"},{default:l((()=>[d(c(T.formatDate(t.commentedAt)),1)])),_:2},1024),i(x,{class:"comment-content"},{default:l((()=>[d(c(t.commentText),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),i(R,{class:"footer"},{default:l((()=>[i(x,{class:"created-info"},{default:l((()=>[d("创建者："+c(C.event.createdBy),1)])),_:1}),i(x,{class:"created-info"},{default:l((()=>[d("创建时间："+c(T.formatDate(C.event.createdAt)),1)])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-9147fd89"]]);export{C as default};
